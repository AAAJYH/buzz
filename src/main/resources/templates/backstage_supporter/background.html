<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>åå°ç®¡ç†</title>

    <!-- å¼•å…¥Easyui -->
    <script type="text/javascript" src="Easyui/jquery.min.js"></script>
    <script type="text/javascript" src="Easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="Easyui/locale/easyui-lang-zh_CN.js"></script>
    <link rel="stylesheet" type="text/css" href="Easyui/themes/default/easyui.css"/>
    <link rel="stylesheet" type="text/css" href="Easyui/themes/icon.css"/>
    <link rel="icon" type="image/x-icon" href='images/logoHead.ico'>
    <script>

       $(function(){

           //åŠ è½½èœå•é›†åˆ
           $('#tree').tree({
               url: '/byAdNameQuerMenu'
           });

           //åˆå§‹åŒ–é€‰é¡¹å¡
           $("#tabs").tabs({
               fit:true, //tabé“ºæ»¡è¡Œ
               justified:true, //ç”Ÿæˆç­‰å®½åº¦tab
               pill:true, //tabæ ·å¼ä¸ºæ°”æ³¡
               closable:true,
               tools:[{ //å·¥å…·æ 
                   iconCls:'icon-no', //å…³é—­å…¨éƒ¨tab
                   handler:function(){
                       var tabs=$("#tabs").tabs("tabs"); //è·å–å…¨éƒ¨tabå¯¹è±¡
                       var tabsLength=tabs.length; //è·å–tabå¯¹è±¡
                       for(var i=0;i<tabsLength;i++){ //éå†åˆ é™¤indexä¸º0çš„tab
                           $("#tabs").tabs("close",tabs[0].title);
                       }
                   }
               }]

           });

           //ç‚¹å‡»èœå•æ·»åŠ é€‰é¡¹å¡
           $("#tree").tree({
               onClick:function() {
               var currentMenu=$("#tree").tree("getSelected");//è·å–ç‚¹ä¸­çš„èœå•
               var title=currentMenu.text;//å½“å‰èœå•åç§°ä½œä¸ºtabsçš„title
                if(currentMenu.children==null){//å¦‚æœå½“å‰èœå•æ²¡æœ‰å­—èœå•æ·»åŠ é€‰é¡¹
                    if($("#tabs").tabs("exists",title)){ //å¦‚æœå·²æ‰“å¼€æ­¤tabæç¤ºè¯·å‹¿æ‰“å¼€
                        $("#tabs").tabs("close",title) //æ ¹æ®tabæ ‡é¢˜å…³é—­å·²æ‰“å¼€çš„tab
                    }
                    //æ·»åŠ tab
                    $('#tabs').tabs('add',{
                        title:title,
                        content:"<iframe src="+currentMenu.url+" frameborder=\"0\" width=\"100%\" height=\"100%\"></iframe>",
                        closable:true,
                        tools:[ //å·¥å…·æ 
                            { //åˆ·æ–°
                            iconCls:'icon-reload',
                            handler:function(){
                                var currentTab = $('#tabs').tabs('getSelected');
                                RefreshTab(currentTab);
                            }
                        },""]
                    });
                }
               }
           });

       });

       //åˆ·æ–°å½“å‰æ ‡ç­¾Tabs
            function RefreshTab(currentTab) {
                $('#tabs').tabs('update', { //æ›´æ–°é€‰é¡¹å¡é¢æ¿çš„å†…å®¹
                    tab: currentTab,//tabè¿˜ä¸ºå½“å‰tab
                    options: { //å±æ€§ä¸­çš„hrefä¸ºå½“å‰é¡µé¢çš„å†…å®¹
                        href: currentTab.content
                    }
                });
              }

    </script>

    <!--ä¸Š-->
    <style type="text/css">
        #top{
            font-size:75%;
            height:60px;
            padding:7px 10px;
            padding:5px 10px;
            background:white;
        }
        #top div{
            float:left;
            margin-left:2%;
            margin-left:1%;
        }
        #top #sy_time{
            font-weight:600;
            color:#1467CE;
        }
        #top #right{
            float:right;
        }
        #top #logout{
            text-align:center;
        }
        #top #logout:hover,#updatePwd{
            cursor:pointer;
        }
        #top #logout,#updatePwd{
            font-size:70%;
            background: #F03A17;
            border:none;
            color:white;
            border-radius:3px;
            padding-top:3px;
            padding-bottom:3px;
        }
        #top .left{
            font-size:110%;
        }
    </style>

</head>

<body class="easyui-layout">

    <div id="top" data-options="region:'north',title:'å—¡&nbsp;å—¡&nbsp;å—¡&nbsp;å&nbsp;å°&nbsp;ç³»&nbsp;ç»Ÿ',split:true">
        <div>ğŸ‘¨è´¦å·ï¼šadmin1</div>&nbsp;&nbsp;
        <button id="updatePwd" title="ä¿®æ”¹å¯†ç ">ä¿®æ”¹å¯†ç </button>
        <button id="logout" title="é€€å‡ºç™»å½•">é€€å‡ºç™»å½•</button>
        <div id="right">â°ç³»ç»Ÿæ—¶é—´ï¼š<span id = "sy_time"></span></div> <!-- å½“å‰æ—¶é—´ -->
    </div>
    <script>

        function getTime(){
            var p = $("#sy_time");
            var time = new Date();
            var year = time.getFullYear();
            var month = time.getMonth() + 1;
            var day = time.getDate();
            var hour = time.getHours();
            var minutes = time.getMinutes();
            var seconds = time.getSeconds();
            var getday=time.getDay();
            var xingqi="";
            if(getday==1){
                xingqi="æ˜ŸæœŸä¸€";
            }else if(getday==2){
                xingqi="æ˜ŸæœŸäºŒ";
            }else if(getday==3){
                xingqi="æ˜ŸæœŸä¸‰";
            }else if(getday==4){
                xingqi="æ˜ŸæœŸå››";
            }else if(getday==5){
                xingqi="æ˜ŸæœŸäº”";
            }else if(getday==6){
                xingqi="æ˜ŸæœŸå…­";
            }else if(getday==7){
                xingqi="æ˜ŸæœŸæ—¥";
            }
            var str = year +"-"+ month +"-"+ day + " "+xingqi+" "+hour+":"+minutes+":"+seconds;
            p.text(str);
            setTimeout(getTime,1000);
        }

        //æ³¨é”€æ–¹æ³•
        function zhuxiao(){
                    $.ajax({
                        url: '/zhuxiao',
                        type: 'post',
                        async: false,
                        dataType: 'text',
                        success: function (data) {
                            window.location.href = "/loginIndex";
                        }
                    });
        }

        $(function() {

            //åŠ¨æ€è·å–å½“å‰æ—¶é—´
            getTime();

            //æ³¨é”€
            $("#logout").click(function () {
                $.messager.confirm('ç¡®è®¤å¯¹è¯æ¡†', 'æ‚¨æƒ³è¦é€€å‡ºè¯¥ç³»ç»Ÿå—ï¼Ÿ', function(r) {
                    if (r) {
                        zhuxiao();
                    }
                });
            });

            //åˆå§‹åŒ–dialog
            $('#dd').dialog({
                title: 'ä¿®æ”¹å¯†ç ',
                width: 400,
                height: "auto",
                closed: true
            });

            //ä¿®æ”¹å¯†ç ç‚¹å‡»äº‹ä»¶æ‰“å¼€å¼¹å‡ºæ¡†
            $("#updatePwd").click(function () {
                $("#dd").dialog("open");
            });

            //ä¿å­˜ï¼ˆç¡®è®¤ä¿®æ”¹äº‹ä»¶ï¼‰
            $("#save").click(function () {
                if ($("#frm").form("validate")) {
                    $.messager.confirm('ç¡®è®¤å¯¹è¯æ¡†', 'æ‚¨ç¡®è®¤è¦ä¿®æ”¹å—ï¼Ÿ', function (r) {
                        if (r) {
                            $("#frm").form("submit", {
                                url: '/updatePwd',
                                success: function (data) {
                                    $("#frm").form("clear");
                                    if (data == "å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•") {
                                        $("#dd").dialog("close");
                                        alert("ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•");
                                        zhuxiao(); //æ³¨é”€
                                    } else {
                                        alert("åŸå¯†ç è¾“å…¥é”™è¯¯");
                                    }
                                }
                            });
                        }
                    });
                } else {
                    alert("è¯·è¾“å…¥å®Œæ•´");
                }
            });

        });
    </script>

    <!--å·¦-->
    <div data-options="region:'west',title:'èœå•æ ',split:true" style="width:270px;">

        <!-- èœå•æ ‘ -->
        <ul id="tree"></ul>

    </div>

    <!--ä¸­-->
    <div data-options="region:'center',title:'SHOW',split:true" style="padding:5px;background:#eee;">

        <!-- é€‰é¡¹å¡ -->
        <div id="tabs" style="width:500px;height:250px;"></div>

    </div>

    <div id="dd" align="center">
        <form id="frm">
            <p><input name="oldPwd" class="easyui-textbox easyui-validatebox" data-options="type:'password',buttonText:'åŸå¯†ç ',buttonAlign:'left',required:true" style="width:300px"></p>
            <p><input name="newPwd" class="easyui-textbox easyui-validatebox" data-options="type:'password',buttonText:'æ–°å¯†ç ',buttonAlign:'left',required:true" style="width:300px"></p>
            <p><a id="save" href="#" class="easyui-linkbutton" data-options="iconCls:'icon-save',width:300">ä¿å­˜</a></p>
        </form>
        </div>

</body>

</html>
