<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>修改绑定手机</title>
    <base href="http://localhost/">
    <link href="css/css+base_css+jquery.suggest_css+plugins_css+plugins+jquery.jgrowl_css+other+popup_css+mfw-header.2015^YlVS^1527308432.css" rel="stylesheet" type="text/css"/>
    <link href="css/isettings.css" rel="stylesheet" type="text/css"/>
    <script language="javascript" src="js/jquery-1.11.0.min.js"></script>
    <link rel="icon" type="image/x-icon" href="images/logoHead.ico">
</head>
<body>
<div id="header" xmlns="http://www.w3.org/1999/html">
    <div class="mfw-header">
        <div class="header-wrap clearfix">
            <div class="head-logo"><a style="background: url('images/logoTop.png') no-repeat 0 0;display: block;height: 39px;position: relative;" title="嗡嗡嗡" href="front_desk/homePage.html"></a></div>
            <ul class="head-nav" id="_j_head_nav">
                <li class="head-nav-index"><a href="front_desk/homePage.html">首页</a></li>
                <li class="head-nav-place"><a href="destinationController/queryAllDestination" title="目的地">目的地</a></li>
                <li class="head-nav-gonglve"><a href="front_desk/askRespond/askRespond.html" title="旅游问答">旅游问答</a></li>
                <li class="head-nav-hotel"><a href="/hotelController/hotel2Index" title="酒店">酒店</a></li>
                <li class="head-nav-hotel"><a href="/mapController/MarkerClustererMapIndex" title="地图">地图</a></li>
            </ul>
            <div id="login_box" class="pagelet-block">
                <div class='login-out'>
                    <a id='_j_showlogin' title='登录嗡嗡嗡' href='usersController/show_login_html' rel='nofollow'>登录</a>
                    <span class='split'>|</span>
                    <a href='usersController/show_login_html' title='注册帐号' rel='nofollow'>注册</a>
                </div>
            </div>
        </div>
        <div class="shadow"></div>
    </div>
</div>
<div class="wrapper clearfix">
    <div class="aside">
        <a href="front_desk/users/my_users.html"><i class="i1"></i>我的信息</a>
        <a href="front_desk/users/my_user_photo.html" ><i class="i2"></i>我的头像</a>
        <a href="/setting/sns/" style="display: none"><i class="i3"></i>绑定设置</a>
        <a href="front_desk/users/my_users_security.html" class="on"><i class="i4"></i>账号安全</a>
        <a href="front_desk/users/my_users_domain.html" ><i class="i8"></i>我的窝设置</a>
        <a href="/setting/blacklist/" style="display: none"><i class="i9"></i>黑名单管理</a>
        <a href="/setting/wallet/" style="display: none"><i class="i10"></i>我的钱包</a>
    </div>
    <div class="content">
        <div class="hd">
            <strong>修改绑定手机</strong>
            <span>
                    资料完善度
                    <div class="progress">
                        <div class="num">0%</div>
                        <div class="on" style="width:0%"></div>
                    </div>
                </span>
        </div>
        <div id="setmail" class="setmail set-mobile-v2"></div>
    </div>
</div>
<link href="css/mfw-footer.css" rel="stylesheet" type="text/css"/>
<div id="footer">
    <div class="ft-content" style="width: 1105px">
        <div class="ft-info clearfix">
            <dl class="ft-info-col ft-info-intro">
                <dt>全球旅游消费指南 </dt>
                <dd>覆盖全球200多个国家和地区</dd>
                <dd><strong>100,000,000</strong> 位旅行者</dd>
                <dd><strong>920,000</strong> 家国际酒店</dd>
                <dd><strong>21,000,000</strong> 条真实点评</dd>
                <dd><strong>382,000,000</strong> 次攻略下载</dd>
                <dd><a class="highlight" target="_blank">中国旅游行业第一部“玩法”</a></dd>
            </dl>
            <dl class="ft-info-col ft-info-about">
                <dt>关于我们</dt>
                <dd><a rel="nofollow">关于嗡嗡嗡</a><a class="m_l_10" rel="nofollow">联系我们</a></dd>
                <dd><a rel="nofollow">隐私政策</a><a rel="nofollow" class="m_l_10">商标声明</a></dd>
                <dd><a rel="nofollow">服务协议</a><a rel="nofollow" class="m_l_10">游记协议</a></dd>
                <dd><a rel="nofollow">商城平台服务协议</a></dd>
                <dd><a rel="nofollow">网络信息侵权通知指引</a></dd>
                <dd><a target="_blank">网站地图</a><a class="joinus highlight m_l_10" title="嗡嗡嗡团队招聘" target="_blank" rel="nofollow">加入嗡嗡嗡</a></dd>
            </dl>
            <dl class="ft-info-col ft-info-service">
                <dt>旅行服务</dt>
                <dd>
                    <ul class="clearfix">
                        <li><a target="_blank">旅游攻略</a></li>
                        <li><a target="_blank">酒店预订</a></li>
                        <li><a target="_blank">旅游特价</a></li>
                        <li><a target="_blank">国际租车</a></li>
                        <li><a target="_blank">旅游问答</a></li>
                        <li><a target="_blank">旅游保险</a></li>
                        <li><a target="_blank">旅游指南</a></li>
                        <li><a target="_blank">订火车票</a></li>
                        <li><a target="_blank">旅游资讯</a></li>
                        <li><a target="_blank">APP下载</a></li>
                        <li style="width: 120px;"><a target="_blank" class="highlight">旅行商城全球商家入驻</a></li>
                    </ul>
                </dd>
            </dl>
            <dl class="ft-info-col ft-info-qrcode">
                <dd>
                    <span class="ft-qrcode-tejia"></span>
                    <p>嗡嗡嗡良品<br>官方服务号</p>
                </dd>
                <dd>
                    <span class="ft-qrcode-weixin"></span>
                    <p>嗡嗡嗡旅游<br>订阅号</p>
                </dd>
                <dd>
                    <span class="ft-qrcode-weixin" style="background-image: url('https://p3-q.mafengwo.net/s10/M00/48/A9/wKgBZ1t_4sSAVJ6uAAAlzJ0PZgU881.png?imageMogr2%2Fthumbnail%2F%2194x90r%2Fgravity%2FCenter%2Fcrop%2F%2194x90%2Fquality%2F90')"></span>
                    <p>嗡嗡嗡APP<br>扫描立即下载</p>
                </dd>
            </dl>
            <dl class="ft-info-social">
                <dt>向崇尚自由的加勒比海盗致敬！</dt>
                <dd>
                    <a class="ft-social-weibo" target="_blank" href="http://weibo.com/mafengwovip" rel="nofollow"><i class="ft-social-icon"></i></a>
                    <a class="ft-social-qqt" target="_blank" href="http://t.qq.com/mafengwovip" rel="nofollow" ><i class="ft-social-icon"></i></a>
                    <a class="ft-social-qzone" target="_blank" href="http://1213600479.qzone.qq.com/" rel="nofollow"><i class="ft-social-icon"></i></a>
                </dd>
            </dl>
        </div>
        <div class="ft-links">
            <a target="_blank" href="http://china.makepolo.com/">马可波罗</a><a target="_blank" href="http://www.onlylady.com/">Onlylady女人志</a><a target="_blank" href="http://trip.elong.com/">艺龙旅游指南</a><a target="_blank" href="http://www.cncn.com">欣欣旅游网</a><a target="_blank" href="http://www.8264.com/">户外运动</a><a target="_blank" href="http://www.yue365.com/">365音乐网</a><a target="_blank" href="http://ishare.iask.sina.com.cn/">爱问共享资料</a><a target="_blank" href="http://www.uzai.com/">旅游网</a><a target="_blank" href="http://www.zongheng.com/">小说网</a><a target="_blank" href="http://www.xuexila.com/">学习啦</a><a target="_blank" href="http://www.yododo.com">游多多自助游</a><a target="_blank" href="http://www.zhcpic.com/">问答</a><a target="_blank" href="http://huoche.mafengwo.cn/">火车时刻表</a><a target="_blank" href="http://www.lvmama.com">驴妈妈旅游网</a><a target="_blank" href="http://www.haodou.com/">好豆美食网</a><a target="_blank" href="http://www.taoche.com/">二手车</a><a target="_blank" href="http://www.lvye.cn">绿野户外</a><a target="_blank" href="http://www.tuniu.com/">途牛旅游网</a><a target="_blank" href="http://www.mapbar.com/">图吧</a><a target="_blank" href="http://www.chnsuv.com">SUV联合越野</a><a target="_blank" href="http://www.uc.cn/">手机浏览器</a><a target="_blank" href="http://sh.city8.com/">上海地图</a><a target="_blank" href="http://www.tianqi.com/">天气预报查询</a><a target="_blank" href="http://www.ly.com/">同程旅游</a><a target="_blank" href="http://www.tieyou.com/">火车票</a><a target="_blank" href="http://www.yunos.com/">YunOS</a><a target="_blank" href="http://you.ctrip.com/">携程旅游</a><a target="_blank" href="http://www.jinjiang.com">锦江旅游</a><a target="_blank" href="http://www.huoche.net/">火车时刻表</a><a target="_blank" href="http://www.tripadvisor.cn/">TripAdvisor</a><a target="_blank" href="http://www.tianxun.com/">天巡网</a><a target="_blank" href="http://www.mayi.com/">短租房</a><a target="_blank" href="http://www.zuzuche.com">租租车</a><a target="_blank" href="http://www.5fen.com/">五分旅游网</a><a target="_blank" href="http://www.zhuna.cn/">酒店预订</a><a target="_blank" href="http://www.ailvxing.com">爱旅行网</a><a target="_blank" href="http://360.mafengwo.cn/all.php">旅游</a><a target="_blank" href="http://vacations.ctrip.com/">旅游网</a><a target="_blank" href="http://www.wed114.cn">wed114结婚网</a><a target="_blank" href="http://www.chexun.com/">车讯网</a><a target="_blank" href="http://www.aoyou.com/">遨游旅游网</a><a target="_blank" href="http://www.91.com/">手机</a>
            <a href="http://www.mafengwo.cn/s/link.html" target="_blank">更多友情链接&gt;&gt;</a>
        </div>
        <div class="ft-copyright">
            <a href="front_desk/homePage.html"><i style="background:url('images/logoBottom.png') no-repeat 0 0px;float:left;width: 136px;height: 39px;overflow: hidden;margin: 8px 20px 0 0;"></i></a>
            <p>© 2018 Mafengwo.cn <a href="http://www.miibeian.gov.cn/" target="_blank" rel="nofollow">京ICP备11015476号</a> <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502013401" target="_blank"><img src="http://images.mafengwo.net/images/footer/police_record.png" width="12" style="margin:0 2px 4px 0;">京公网安备11010502013401号</a> <a href="http://images.mafengwo.net/images/about/icp2.jpg" target="_blank" rel="nofollow">京ICP证110318号</a><span class="m_l_10">违法和不良信息举报电话: 010-59222790 举报邮箱 mfwyouji@mafengwo.com</span></p>
            <p>网络出版服务许可证：(总)网出证(京)字第161号<span class="m_l_10">增值电信业务经营许可证：京B2-20180228</span> <a href="http://images.mafengwo.net/images/about/licence_3.jpg" target="_blank" rel="nofollow" class="m_l_10">营业执照</a><a href="/sales/uhelp/doc" target="_blank" rel="nofollow" class="m_l_10">帮助中心</a><span class="m_l_10">嗡嗡嗡客服：国内</span><span class="highlight">4006-345-678</span><span class="m_l_10">海外</span> <span class="highlight">+86-10-5922-2799</span></p>
        </div>
        <div class="ft-safety">
            <a class="s-a" target="_blank" href="https://search.szfw.org/cert/l/CX20140627008255008321" id="___szfw_logo___"></a>
            <a class="s-b" href="https://ss.knet.cn/verifyseal.dll?sn=e130816110100420286o93000000&ct=df&a=1&pa=787189" target="_blank" rel="nofollow"></a>
            <a class="s-c" href="http://www.itrust.org.cn/Home/Index/itrust_certifi/wm/1669928206.html" target="_blank" rel="nofollow"></a>
        </div>
    </div>
</div>
<input type="hidden" id="userId">
<input type="hidden" id="bindEmail">
<input type="hidden" id="bindPhone">
<input type="hidden" id="updatebindPhone">
<input type="hidden" id="verificationMode">
<input type="hidden" id="verificationCode">
<input type="hidden" id="updateId">
<script>
        $().ready(
            function()
            {
                //获取当前登录用户
                $.ajax({
                    url:"usersController/getCurrentLoginUser",
                    dataType:"json",
                    type:"post",
                    success:function(data)
                    {
                        if(null!=data)
                        {
                            var login_boxHtml="";
                            if(data.loginState)
                                login_boxHtml="<div class='login-info'><div class='head-user' id='_j_head_user'><a class='drop-trigger' href='front_desk/users/personalSpace.html?userId="+data.currentUser.userId+"' title='"+data.currentUser.userName+"的窝' rel='nofollow'><div class='user-image'><img src='"+data.currentUser.photo+"' height='32' width='32'></div><i class='icon-caret-down'></i></a></div><div class='head-msg' id='_j_head_msg'><a class='drop-trigger' href='javascript:' rel='nofollow'><i class='icon-msg'></i>消息<i class='icon-caret-down'></i><span class='head-msg-new hide' style='display: none;'></span></a></div></div><div class='dropdown-group'><div class='dropdown-menu dropdown-msg hide' id='_j_msg_panel' style='z-index: 10; display: none;'><ul><li><a href='front_desk/message/my_replyAskRespondCommentMessage.html' target='_blank' rel='nofollow'>回答评论</a></li><li><a href='front_desk/message/my_replyAskRespondMessage.html' target='_blank' rel='nofollow'>问答消息</a></li><li><a href='front_desk/message/my_travelNotesReplyMessage.html' target='_blank' rel='nofollow'>游记评论</a></li></ul></div><div class='dropdown-menu dropdown-msg hide' id='_j_msg_float_panel' style='display: none;'><ul></ul><a href='javascript:' class='close-newmsg'>×</a></div><div class='dropdown-menu dropdown-user hide' id='_j_user_panel' data-cs-t='user_nav' style='display: none;'><div class='user-info'><a class='coin' href='front_desk/users/personalSpace.html?userId="+data.currentUser.userId+"' target='_blank'>"+data.currentUser.userName+"</a></div><ul><li><a href='front_desk/users/personalSpace.html?userId="+data.currentUser.userId+"' target='_blank' title='我的嗡嗡嗡' ><i class='icon-wo'></i>我的嗡嗡嗡</a></li><li><a href='front_desk/travelNotes/createNoteIndex.html' target='_blank' class='drop-write' title='写游记'><i class='icon-writenotes'></i>写游记</a></li><li><a href='front_desk/users/my_collect_scenicSpotCollect.html' title='我的收藏' target='_blank' rel='nofollow' data-cs-p='collect'><i class='icon-collect'></i>我的收藏</a></li><li><a href='front_desk/users/my_replyAskRespond.html?userId="+data.currentUser.userId+"' target='_blank' title='我的问答' rel='nofollow' data-cs-p='wenda'><i class='icon-wenda'></i>我的问答</a></li><li><a href='front_desk/users/travelNotes.html?userId="+data.currentUser.userId+"' target='_blank' class='drop-write' title='我的游记' rel='nofollow' data-cs-p='appointnotes'><i class='icon-ordernotes'></i>我的游记</a></li><li><a href='front_desk/users/my_travelCollection.html?userId="+data.currentUser.userId+"' target='_blank' title='游记收藏' rel='nofollow'><i class='icon-path'></i>游记收藏</a></li><li><a href='front_desk/users/my_orderForm.html' title='我的订单' target='_blank' rel='nofollow' data-cs-p='order'><i class='icon-order'></i>我的订单</a></li><li><a href='front_desk/users/my_users.html' title='我的设置' target='_blank' rel='nofollow' data-cs-p='settings'><i class='icon-settings'></i>设置</a></li><li><a onclick='logout()' title='退出登录' rel='nofollow'><i class='icon-logout' data-cs-p='logout'></i>退出</a></li></ul></div></div>";
                            else
                                window.location.href="usersController/show_login_html?url="+window.location.href;
                            $("#login_box").html(login_boxHtml);
                            //判断悬浮不是用户头像或者不是用户下拉列表隐藏
                            $(document).mouseover(
                                function(e)
                                {
                                    if(0<$(e.target).closest("#_j_user_panel").length||0<$(e.target).closest("#_j_head_user").length)
                                        $("#_j_user_panel").css("display","block");
                                    else
                                        $("#_j_user_panel").css("display","none");
                                    if(0<$(e.target).closest("#_j_head_msg").length||0<$(e.target).closest("#_j_msg_panel").length)
                                        $("#_j_msg_panel").css("display","block");
                                    else
                                        $("#_j_msg_panel").css("display","none");
                                }
                            );
                            $("#userId").val(data.currentUser.userId);
                            var progressNum=0;
                            if(null!=data.currentUser.userName&&""!=data.currentUser.userName)
                                $("#userName").val(data.currentUser.userName);
                            if(null!=data.currentUser.address&&""!=data.currentUser.address)
                                progressNum++;
                            if(null!=data.currentUser.birthDate&&""!=data.currentUser.birthDate)
                                progressNum++;
                            if(null!=data.currentUser.individualResume&&""!=data.currentUser.individualResume)
                                progressNum++;
                            if(null!=data.currentUser.bindEmail&&""!=data.currentUser.bindEmail)
                                progressNum++;
                            if(null!=data.currentUser.bindPhone&&""!=data.currentUser.bindPhone)
                                progressNum++;
                            var progress=progressNum/5*100;
                            $(".progress .num").text(progress+"%");
                            $(".progress .on").css("width",progress+"%");
                            find_userbindPhone(data.currentUser.userId,data.currentUser);
                        }
                    }
                });
            }
        );
    //退出登录
    function logout()
    {
        $.ajax({
            url:"usersController/loginOut",
            dataType:"json",
            type:"post",
            success:function (data)
            {
                if(data)
                    window.location.href=window.location.href;
            }
        });
    }
        //根据用户编号查询修改手机
        function find_userbindPhone(userId,user) {
            $.ajax({
                url: "userbindEmailAndbindPhoneController/find_userbindEmailAndbindPhoneByuserIdAndtype",
                dataType: "json",
                type: "post",
                data: {userId: userId,type:"updatebindPhone"},
                success: function (data)
                {
                    var bindPhone=user.bindPhone;
                    var bindEmail=user.bindEmail;
                    $("#bindPhone").val(bindPhone);
                    $("#bindEmail").val(bindEmail);
                    if (null != data&&data.result&&null!=data.ueap.updatebindPhonestateId&&""!=data.ueap.updatebindPhonestateId)
                    {
                        $("#updateId").val(data.ueap.updateId);
                        var updatebindPhonestateId = data.ueap.updatebindPhonestateId;
                        if (null != updatebindPhonestateId && updatebindPhonestateId == "009291aa-e66a-427b-aa10-413dfcb89719")//修改手机成功
                            $(".setmail").html("<div id='setmail' class='setmail set-mobile-v2'><div class='navtag'><a class='step1'><i></i>身份验证</a><a class='step2'><i></i>修改绑定手机</a><a class='step3 on'><i></i>完成修改</a></div><div class='set-mobile'><p class='t-tit'><i></i>修改成功</p><p class='t1'>新的手机号为：<strong>"+bindPhone+"</strong><br>可使用新的手机号进行登录</p><p class='go-email'><a class='btn-sub' onclick='reset()'>重新设置</a></p></div></div>");
                    }
                    else
                    {
                        if(null != data&&data.result&&null!=data.ueap.verificationCode&&""!=data.ueap.verificationCode)
                        {
                            $("#verificationCode").val(data.ueap.verificationCode);
                            $("#updateId").val(data.ueap.updateId);
                        }
                        var phone=bindPhone.substring(0,3)+"****"+bindPhone.substring(7);
                        var sel_option="<input type='text' readonly='readonly' id='sel_option' data-type='phone' onclick='sel_option()' value='使用"+phone+"验证'>";
                        var _j_sel_optionHtml="";
                        _j_sel_optionHtml+="<a  data-type='phone' onclick='sel_verificationmode(this)'>使用"+phone+"验证</a>";
                        if(null!=bindEmail&&""!=bindEmail)
                        {
                            var emialprev=bindEmail.substring(0,bindEmail.indexOf("@"));
                            var emialnext=bindEmail.substring(bindEmail.indexOf("@"));
                            var emial=emialprev.substring(0,2)+"*****"+emialnext;
                            _j_sel_optionHtml+="<a  data-type='email' onclick='sel_verificationmode(this)'>使用"+emial+"验证</a>";
                        }
                        var setmail = "<div class='navtag'><a class='step1 on' ><i></i>身份验证</a><a class='step2'><i></i>修改绑定手机</a><a class='step3'><i></i>完成修改</a></div>";
                        setmail +="<div class='set-mobile'><div class='tips'>我们将向该手机发送验证码，请在下方输入您看到的验证码</div><dl class='clearfix'><dt>验证方式：</dt><dd><div class='sel-way'>"+sel_option+"<i></i><em></em><div class='option _j_sel_option' style='display: none;'>"+_j_sel_optionHtml+"</div></div><a class='btn-code getIdVerifyCode' data-time='0' onclick='getIdVerifyCode()'>获取验证码</a></dd></dl><dl class='clearfix'><dt>验证码：</dt><dd><input id='verifyCode' type='text' value='' placeholder='请输入验证码'></dd></dl><div class='btns'><a id='id_verify' class='btn-sub' onclick='submit_checkCode()'>提交</a></div></div>";
                        $(".setmail").html(setmail);
                    }
                }
            });
        }
        //显示验证方式
        function sel_option()
        {
            $("._j_sel_option").css("display","block");
        }
        //鼠标点击手机或者邮箱验证方式时
        function sel_verificationmode(obj)
        {
            var data_type=$(obj).attr("data-type");
            var text=$(obj).text();
            $("#sel_option").attr("data-type",data_type);
            $("#sel_option").val(text);
        }
        //获取验证码
        function getIdVerifyCode()
        {
            var times = parseInt($(".getIdVerifyCode").attr("data-time"));
            if(null==times||""==times||0>=times)
            {
                var data_type=$("#sel_option").attr("data-type");
                var passport="";
                if(data_type=="phone")
                    passport=$("#bindPhone").val();
                else
                    passport=$("#bindEmail").val();
                if(null!=passport&&""!=passport)
                {
                    $.ajax({
                        url:"usersController/send_updatebindPhoneMessage",
                        dataType:"json",
                        type:"post",
                        data:{userId:$("#userId").val(),passport:passport},
                        success:function(data)
                        {
                            if(data.result)
                            {
                                $("#verificationCode").val(data.verificationCode);
                                if(data.type=="phone")
                                    showsucceedalert("验证码已经以短信的形式发送到你的手机，请注意查收！");
                                else
                                    showsucceedalert("验证码已经发送到你的邮箱，请注意查收！");
                                $(".getIdVerifyCode").attr("data-time",60);
                                $(".getIdVerifyCode").addClass("disabled btn-code-dis");
                                $(".getIdVerifyCode").text("60秒后重新获取");
                                var interval = setInterval(function () {
                                    var time = parseInt($(".getIdVerifyCode").attr("data-time"));
                                    if (time <= 0)
                                    {
                                        $(".getIdVerifyCode").attr("data-time",0);
                                        $(".getIdVerifyCode").removeClass("disabled btn-code-dis");
                                        $(".getIdVerifyCode").text("重新获取验证码");
                                        clearInterval(interval);
                                    }
                                    else
                                    {
                                        time--;
                                        $(".getIdVerifyCode").attr("data-time",time);
                                        $(".getIdVerifyCode").text(time+"秒后重新获取");
                                    }
                                }, 1000);
                            }
                            else
                                showalert("发送验证码失败,请重试");
                        }
                    });
                }
                else
                    showalert("联系方式为空,请重试");
            }
        }
        //获取改变手机号的验证码
        function getChangeCode()
        {
            var times = parseInt($("#getChangeCode").attr("data-time"));
            if(null==times||""==times||0>=times)
            {
                var newMobile=$("#newMobile").val();
                var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;
                if(myreg.test(newMobile))
                {
                    $.ajax({
                        url:"usersController/checkbindPhone",
                        dataType:"json",
                        type:"post",
                        data:{bindPhone:newMobile},
                        success:function(result)
                        {
                            if(result==2)
                                showalert("手机号已存在");
                            else if(result==1)
                            {
                                $.ajax({
                                    url:"usersController/send_updatebindEmailorupdatebindPhoneMessage",
                                    dataType:"json",
                                    type:"post",
                                    data:{userId:$("#userId").val(),passport:newMobile},
                                    success:function(data)
                                    {
                                        if(null!=data&&data.result)
                                        {
                                            $("#verificationCode").val(data.verificationCode);
                                            showsucceedalert("验证码已经以短信的形式发送到你的手机，请注意查收！");
                                            $("#getChangeCode").attr("data-time",60);
                                            $("#getChangeCode").addClass("btn-code-dis");
                                            $("#getChangeCode").text("已发送60s");
                                            var interval = setInterval(function () {
                                                var time = parseInt($("#getChangeCode").attr("data-time"));
                                                if (time <= 0)
                                                {
                                                    $("#getChangeCode").attr("data-time",0);
                                                    $("#getChangeCode").removeClass("btn-code-dis");
                                                    $("#getChangeCode").text("获取验证码");
                                                    clearInterval(interval);
                                                }
                                                else
                                                {
                                                    time--;
                                                    $("#getChangeCode").attr("data-time",time);
                                                    $("#getChangeCode").text("已发送"+time+"s");
                                                }
                                            }, 1000);
                                        }
                                        else
                                            showalert("发送验证码失败,请重试");
                                    }
                                });
                            }
                            else
                                showalert("手机号为空或格式错误");
                        }
                    });
                }
                else
                    showalert("手机号格式不正确");
            }
        }
        //点击提交校验改变邮箱的验证码是否正确
        function change_mobile()
        {
            var verificationCode=$("#verificationCode").val();
            var verifyCode=$("#verifyCode").val();
            if(null!=verifyCode&&""!=verifyCode)
            {
                if(null!=verificationCode&&""!=verificationCode)
                {
                    if(verificationCode==verifyCode)
                    {
                        var newMobile=$("#newMobile").val();
                        var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;
                        if(myreg.test(newMobile))
                        {
                            $.ajax({
                                url: "usersController/checkbindPhone",
                                dataType: "json",
                                type: "post",
                                data: {bindPhone: newMobile},
                                success: function (result) {
                                    if (result == 2)
                                        showalert("手机号已存在");
                                    else if (result == 1)
                                    {
                                        $.ajax({
                                            url:"userbindEmailAndbindPhoneController/update_updatebindPhonestateIdAndusers_bindPhoneByupdateId",
                                            dataType:"json",
                                            type:"post",
                                            data:{updateId:$("#updateId").val(),bindPhone:newMobile},
                                            success:function(data)
                                            {
                                                if(data)
                                                    window.location.href=window.location.href;
                                                else
                                                    showalert("修改绑定手机号错误,请重试");
                                            }
                                        });
                                    }
                                    else
                                        showalert("手机号为空或格式错误");
                                }
                            });
                        }
                        else
                            showalert("手机号为空或格式不正确");
                    }
                    else
                        showalert("验证码错误,请重新输入");
                }
                else
                    showalert("请获取验证码");
            }
            else
                showalert("验证码不能为空");
        }
        //校验验证码是否正确
        function submit_checkCode()
        {
            var verificationCode=$("#verificationCode").val();
            var verifyCode=$("#verifyCode").val();
            if(null!=verifyCode&&""!=verifyCode)
            {
                if(null!=verificationCode&&""!=verificationCode)
                {
                    if(verificationCode==verifyCode)
                    {
                        var setmail="<div class='navtag'><a class='step1'><i></i>身份验证</a><a class='step2 on'><i></i>修改绑定手机</a><a class='step3'><i></i>完成修改</a></div><div class='set-mobile'><dl class='clearfix'><dt style='width:116px;'>新的手机号码：</dt><dd><div class='sel-way'><input id='newMobile' type='text' value='' placeholder=''><i></i><em></em></div><a id='getChangeCode' data-time='0' onclick='getChangeCode()' class='btn-code'>获取验证码</a></dd></dl><dl class='clearfix'><dt style='width:116px;'>验证码：</dt><dd><input id='verifyCode' type='text' placeholder='请输入6位数字验证码'></dd></dl><div class='btns' style='padding-left:126px'><a id='change_mobile' onclick='change_mobile()' class='btn-sub'>提交</a></div></div>";
                        $(".setmail").html(setmail);
                    }
                    else
                        showalert("验证码错误,请重新输入");
                }
                else
                    showalert("请获取验证码");
            }
            else
                showalert("验证码不能为空");
        }
        //重新设置
        function reset()
        {
            var updateId=$("#updateId").val();
            $.ajax({
                url:"userbindEmailAndbindPhoneController/delete_userbindEmailAndbindPhoneByupdateId",
                dataType:"json",
                type:"post",
                data:{updateId:updateId},
                success:function(data)
                {
                    if(data)
                        window.location.href=window.location.href;
                    else
                        showalert("重新设置失败,请重试");
                }
            });
        }
        //鼠标点击别的地方时,隐藏验证方式
        $(document).click(
            function(e)
            {
                if(0<$(e.target).closest("#sel_option").length)
                    $("._j_sel_option").css("display","block");
                else
                    $("._j_sel_option").css("display","none");
            }
        );
        <!--显示成功提示框,具有确认按钮-->
        function showsucceedalert(msg)
        {
            var width=$(window).width();
            var height=$(window).height();
            var left=width/2-210;
            var top=height/2-130;
            $("body").append("<div id='_j_layer_4' class='layer _j_layer' style='position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 10001;'><div class='layer_mask _j_mask' style='position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; background: rgb(0, 0, 0); opacity: 0.7; z-index: -1;'></div><div class='layer_content _j_content' style='position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 0; overflow: hidden;'><div id='popup_container4' class='popup-box new-popbox pop_no_margin' style='position: absolute; opacity: 1; background: rgb(255, 255, 255); z-index: 1; width: 420px; left:"+left+"px; top:"+top+"px;'><a class='close-btn _j_close' onclick='closeModel(this)' data-id='_j_layer_4'><i></i></a><div class='pop-ico' id='_j_alertpopicon'><i class='i3'></i></div><div class='pop-ctn'><p class='hd _j_content'>"+msg+"</p><p class='bd _j_detail'></p></div><div class='pop-btns'><a role='button' tabindex='0' class='popbtn popbtn-submit _j_close' onclick='closeModel(this)' data-id='_j_layer_4'>&nbsp;确定&nbsp;</a></div></div></div></div>");
        }
        //显示具有确认按钮模态框
        function showalert(msg)
        {
            var width=$(window).width();
            var height=$(window).height();
            var left=width/2-210;
            var top=height/2-130;
            $("body").append("<div id='_j_layer_0' class='layer _j_layer' style='position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 10001;'><div class='layer_mask _j_mask' style='position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; background: rgb(0, 0, 0); opacity: 0.7;z-index: -1;'></div><div class='layer_content _j_content' style='position: fixed; width: 100%; height: 100%; top: 0px; left: 0px;z-index: 0; overflow: hidden;'><div id='popup_container1' class='popup-box new-popbox pop_no_margin' style='position: absolute; opacity: 1; background: rgb(255, 255, 255); z-index: 1; width: 420px; left: "+left+"px; top:"+top+"px;'><a class='close-btn _j_close' onclick='closeModel(this)' data-id='_j_layer_0'><i></i></a><div class='pop-ico' id='_j_alertpopicon'><i class='i1'></i></div><div class='pop-ctn'><p class='hd _j_content'>"+msg+"</p><p class='bd _j_detail'></p></div><div class='pop-btns'><a role='button' tabindex='0' class='popbtn popbtn-submit _j_close' onclick='closeModel(this)' data-id='_j_layer_0'>&nbsp;确定&nbsp;</a></div></div></div></div>");
        }
        //关闭模态框
        function closeModel(obj)
        {
            var data_id=$(obj).attr("data-id");
            $("#"+data_id).remove();
        }
        //页面大小变更,更改模态框在页面显示的位置
        window.onresize = function(){
            var width=$(window).width();
            var height=$(window).height();
            width=width/2-210;
            height=height/2-130;
            var width1=$(window).width()/2-350;
            var height1=$(window).height()/2-250;
            if(width1<=0)
                width1=0;
            if(height1<=0)
                height1=0;
            $("#popup_container1").css({"left":width+"px","top":height+"px"});
            $("#popup_container2").css({"left":width+"px","top":height+"px"});
            $("#popup_container4").css({"left":width+"px","top":height+"px"});
            $("#popup_container5").css({"left":width+"px","top":height+"px"});
            $("#popup_container6").css({"left":width+"px","top":height+"px"});
            $("#popup_container7").css({"left":width+"px","top":height+"px"});
            if($("#popup_container3").length>0)
                $("#popup_container3").css({"left":width1+"px","top":height1+"px"});
            if($(".popup-body").length>0)
                $(".popup-body").css({"left":width1+"px","top":height1+"px"});
        }
</script>
</body>
</html>
