
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>景点详情 - 嗡嗡嗡</title>
    <link th:href="@{'http://css.mafengwo.net/css/cv/css+base:css+jquery.suggest:css+plugins:css+plugins+jquery.jgrowl:css+other+popup:css+mfw-header.2015^YlVS^1527308432.css'}" rel="stylesheet" type="text/css"/>
    <link th:href="@{'http://css.mafengwo.net/css/cv/css+mdd+scenic-v2:css+mdd+mfw-reviews^YFI^1519936459.css'}" rel="stylesheet" type="text/css"/>
    <link th:href="@{'http://css.mafengwo.net/css/mdd/mfw-reviews.css?1519936459'}" rel="stylesheet" type="text/css"/>
    <script language="javascript" src="/js/js+jquery-1.8.1.min_js+global+json2_js+M+Module_js+M+M_js+M+Log_js+m.statistics_js+advert+inspector^alw^1536006240.js" type="text/javascript" crossorigin="anonymous"></script>
    <script language="javascript" src="/js/jquery.upnum.js" type="text/javascript" crossorigin="anonymous"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=db8lBBNiGd42lnbVCygGsLSrxXobnA6I"></script>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" th:href="@{'/css/jquery.galpop.css'}" media="screen" />
    <script type="text/javascript" th:src="@{'/js/jquery-1.11.0.min.js'}"></script>
    <link rel="icon" type="image/x-icon" href='/images/logoHead.ico'>
    <!--星星css-->
    <link href="http://css.mafengwo.net/css/cv/css+hotel+detail:css+hotel+datepicker-range:css+hotel+number_guests_picker:css+hotel_pop:css+mdd+hotel_fav:css+mdd+map-mark.v2:css+jquery-ui-1.9.1.custom.min^YlBU^1525846268.css" rel="stylesheet" type="text/css"/>

</head>
<body>

<!-- 顶部导航菜单栏 -->
<div id="header" xmlns="http://www.w3.org/1999/html">
    <div class="mfw-header">
        <div class="header-wrap clearfix">
            <div class="head-logo">
                <img class="mfw-logo" title="嗡嗡嗡自由行" src="/images/blue.jpg"></img>
            </div>
            <ul class="head-nav" data-cs-t="headnav" id="_j_head_nav">
                <li class="head-nav-index"><a href="#">首页</a></li>
                <li class="head-nav-index"><a href="/destinationController/queryAllDestination">目的地</a></li>
                <li class="head-nav-index"><a href="/hotelController/hotel2Index" target="_blank">酒店</a></li>
                <li class="head-nav-index"><a href="/mapController/MarkerClustererMapIndex" target="_blank">地图</a></li>
                <li class="head-nav-index"><a href="#">游记</a></li>
                <li class="head-nav-index"><a href="#">问答</a></li>
            </ul>
            <div data-pagelet id="pagelet-block-a783145c4cd460664b408620875244c9" class="" data-api="apps:user:pagelet:pageViewHeadInfo" data-params="{&quot;type&quot;:1}" data-async="1" data-controller="/js/pageletcommon/pageHeadUserInfoWWWNormal"></div>
            <!-- 登录模块 -->
            <style type="text/css">
                .login_register{
                    width:100px;
                    height:40px;
                    padding-top:25px;
                    position:absolute;
                    right:-3%;
                    top:0;
                    font-size:110%;
                }
                .login_register a{
                    color:#FF9F05;
                }
                .photo{
                    width:50px;
                    height:50px;
                    border-radius:25px;
                    position:absolute;
                    right:3%;
                    top:15%;
                }
            </style>

            <span th:if="${session.user!=null}">
                <img th:src="@{'/'+${session.user.photo}}" class="photo">
            </span>

            <div th:if="${session.user==null}" class="login_register" id="login">
                <a href="javascript:;">登录</a>
            </div>

            <script>
                $("#login").click(function(){
                    window.location.href='/usersController/show_login_html?url='+(window.location.href).toString();
                });
            </script>
            <!--登录模块-->
        </div>
        <div class="shadow"></div>
    </div>
</div>



<div class="container" data-cs-t="景点详情页">

    <div class="row row-top">
        <div class="wrapper">
            <div class="extra">
                <!-- 收藏去过 S-->
                <div class="action _j_rside want-been" style="margin-top:50px;">
                    <a th:if="${state=='已收藏'}" class="_j_favpoi btn-collect on" href="javascript:;" title="查看我的收藏"  data-cs-p="收藏">
                        <i class="icon"></i>
                        <span class="txt">已收藏</span>
                    </a>
                    <a id="collect" th:if="${state=='未收藏'}" class="_j_favpoi btn-collect " href="javascript:;" title="收藏"  data-cs-p="收藏">
                        <i class="icon"></i>
                        <span class="txt">收藏</span>
                    </a>
                </div>
                <script th:inline="javascript">
                    $("#collect").click(function(){
                        if([[${session.user}]]==null){
                            alert("请先登录");
                            window.location.href="#login"; //锚点
                        }else{
                            $.ajax({
                                url:'/scenicspotCollectController/addScenicspotCollect',
                                type:'post',
                                data:{
                                    scenicspotId:[[${scenicspot.scenicSpotId}]]
                                },
                                dataType:'text',
                                success:function(data){
                                    if(data>0){
                                        $(".action").html("<a th:if=\"${state=='已收藏'}\" class=\"_j_favpoi btn-collect on\" href=\"javascript:;\" title=\"查看我的收藏\"  data-cs-p=\"收藏\">\n" +
                                            "                        <i class=\"icon\"></i>\n" +
                                            "                        <span class=\"txt\">已收藏</span>\n" +
                                            "                    </a>");
                                    }else{
                                        alert("收藏失败，请重新收藏");
                                    }
                                }
                            });
                        }
                    });
                </script>
                <!-- 收藏去过 E-->
            </div>

            <!-- 目的地>北京>北京>北京景点>故宫 S-->
            <div class="crumb" data-cs-p="面包屑">
                <div class="item">目的地<em>&gt;</em></div>
                <div class="item"><span th:text="${city.cityName}">北京</span><em>&gt;</em></div>
                <div class="item cur" style="color:#FF7000;" th:text="${scenicspot.chineseName}">故宫</div>
            </div>

            <!-- 景点名称 S-->
            <div class="title" style="margin-top:30px;">
                <h1 th:text="${scenicspot.chineseName}">故宫</h1>
                <div class="en" th:text="${scenicspot.englishName}">The Palace Museum</div>
            </div>

            <!-- 快捷导航 S-->
            <div class="r-nav" id="poi-navbar"  data-cs-p="快捷导航">
                <ul class="clearfix">
                    <li data-scroll="overview" class="on">
                        <a title="概况">概况</a>
                    </li>
                    <li data-scroll="commentlist">
                        <a title="嗡嗡点评">嗡嗡点评<span id="feng_feng_dian_ping">（12133条）</span></a>
                    </li>
                    <li class="nav-right" onclick="dianping()">
                        <a class="btn-reviews" title="我要点评">我要点评</a>
                        <script th:inline="javascript">
                            function dianping(){
                                if([[${session.user}]]!=null){
                                    $("#comment_20181004083747").css("display","block");
                                    $(".nav-right").attr("data-scroll","comment");
                                }else{
                                    alert("请登录");
                                    window.location.href="#login"; //锚点
                                }
                            }
                        </script>
                    </li>
                </ul>
            </div>

        </div>
    </div>
    <script type="text/javascript" th:inline="javascript">
        (function(){
            //面包屑
            $('.drop').hover(function(){
                var target = $(this);
                clearTimeout(target.data('hideTimer'));
                target.addClass('open');
                target.children('bd').fadeIn(200);
            },function(){
                var target = $(this);
                target.data("hideTimer", setTimeout(function() {
                    target.removeClass('open');
                    target.children('bd').fadeOut(200);
                }, 100));
            });
            //导航
            var $navbar = $('#poi-navbar'),
                offset_top,
                $lis = $navbar.find("li").not('.nav-right');
            $('<div/>').insertBefore($navbar).append($navbar).height($navbar.outerHeight(true));
            $(function(){
                offset_top = $navbar.offset().top;
                $(window).bind('scroll.poinav',setFixed).trigger("scroll.poinav");
            });
            $(document).delegate("[data-scroll]","click",function(){
                scrollTo($(this));
            });
            function setFixed(){
                var $rows = $('body >.container >[data-anchor]'),
                    scrolltop = $(document).scrollTop(),
                    h,
                    _lis=$lis.filter(":visible"),
                    currIndex;
                if(scrolltop  > offset_top){
                    if(!$navbar.hasClass('fixed')){
                        $navbar.addClass('fixed');
                    }
                    h = $navbar.outerHeight(true);
                    for (var $li, $row,top, i = 0, j = _lis.length; i < j; i++) {
                        $row = $rows.filter("[data-anchor=" + ($li = _lis.eq(i)).attr("data-scroll")+"]");
                        if ($row[0] && (top = $row.offset().top) && ( /*i == (j - 1) ||*/
                                ((top - h <= scrolltop) && (top + $row.outerHeight() - h > scrolltop)))) {
                            currIndex = i;
                            break;
                        }
                    }
                    if(i==j){
                        _lis.removeClass("on");
                    }else{
                        _lis.eq(currIndex || 0).addClass("on").siblings().removeClass("on");
                    }
                }else{
                    if($navbar.hasClass('fixed')){
                        $navbar.removeClass('fixed');
                    }
                    _lis.eq(0).addClass("on").siblings().removeClass("on");
                }
            }

            function scrollTo(target, pos) {
                pos = target ? target.data('scroll') : pos;
                var $target = $('[data-anchor=' + pos + ']'), top;
                if ($target[0]) {
                    top = $target.offset().top;
                    if (top > offset_top) {
                        top -= $navbar.outerHeight();
                    }
                    $('html,body').animate({
                        scrollTop: Math.ceil(top)
                    }, 500);
                }
            }

            $(function () {
                if (location.hash) {
                    scrollTo(null, location.hash.replace(/^#/, ''));
                }
            });

        })();
    </script>

    <div data-anchor="overview">
        <!--图片-->
        <div class="row row-picture row-bg">
            <div class="wrapper">
                <a class="photo" data-cs-p="相册" href="javascript:" target="_blank">
                    <div class="bd">
                    <div class="pic-big">
                        <a class="galpop-multiple" data-galpop-group="multiple" th:href="@{'/'+${scenicspot.photo.split(',')[0]}}">
                            <img th:src="@{'/'+${scenicspot.photo.split(',')[0]}}" width="690" height="370" class="img-thumbnail"/>
                        </a>
                    </div>
                    <div class="pic-small">
                        <a class="galpop-multiple" data-galpop-group="multiple" th:href="@{'/'+${scenicspot.photo.split(',')[1]}}">
                            <img th:src="@{'/'+${scenicspot.photo.split(',')[1]}}" width="305" height="183" class="img-thumbnail"/>
                        </a>
                    </div>
                    <div class="pic-small">
                        <a class="galpop-multiple" data-galpop-group="multiple" th:href="@{'/'+${scenicspot.photo.split(',')[2]}}">
                            <img th:src="@{'/'+${scenicspot.photo.split(',')[2]}}" width="305" height="183" class="img-thumbnail"/>
                        </a>
                    </div>
                    <div class="pic-small" th:each="str,status:${scenicspot.photo.split(',')}">
                        <a th:if="${status.index>2}" class="galpop-multiple" data-galpop-group="multiple" th:href="@{'/'+${str}}">
                            <img th:src="@{'/'+${str}}" width="305" height="183" class="img-thumbnail"/>
                        </a>
                    </div>
                    <span th:text="${'共'+scenicspot.photo.split(',').length+'张图片'}">43197张图片</span>
                </div>
                </a>
            </div>
        </div>
        <!--图片js-->
        <script th:src="@{'http://cdn.bootcss.com/jquery/1.11.0/jquery.min.js'}" type="text/javascript"></script>
        <script type="text/javascript" th:src="@{'/js/jquery.galpop.min.js'}"></script>
        <script type="text/javascript" th:inline="javascript">
            $(document).ready(function() {
                $('.galpop-single').galpop();
                $('.galpop-multiple').galpop();
                $('.galpop-info').galpop();
                var callback = function() {
                    var wrapper = $('#galpop-wrapper');
                    var info    = $('#galpop-info');
                    var count   = 5;
                    var index   = 0;
                    var current = index + 1;
                    var string  = 'Image '+ current +' of '+ count;
                    info.append('<p>'+ string +'</p>').fadeIn();
                };
                $('.galpop-callback').galpop({
                    callback: callback
                });
                $('.manual-open').change(function(e) {
                    var image = $(this).val();
                    if (image) {
                        var settings = {};
                        $.fn.galpop('openBox',settings,image);
                    }
                });
                $('.click-open-iframe').galpop({
                    contentType: 'iframe',
                });

                $('.click-open-ajax').galpop({
                    contentType: 'AJAX',
                });
            });
        </script>

        <!-- 简介 S -->
        <div class="mod mod-detail" data-cs-p="概况">
            <div class="summary" th:text="${scenicspot.getSynopsis()}">
                又名紫禁城，是中国乃至世界上保存最完整，规模最大的木质结构古建筑群，被誉为“世界五大宫之首”。<br />
            </div>

            <ul class="baseinfo clearfix">
                <li class="tel">
                    <div class="label">电话</div>
                    <div class="content" th:text="${scenicspot.getPhone()}">010-85007421</div>
                </li>
                <li class="item-site" style="width:300px;">
                    <div class="label">网址</div>
                    <div class="content"><a th:href="${scenicspot.url}" target="_blank" rel="nofollow"><span th:text="${scenicspot.url}">http://www.dpm.org.cn</span></a></div>
                </li>
            </ul>

            <dl>
                <dt>交通</dt>
                <dd th:text="${scenicspot.traffic}">乘坐1路、2路、52路、59路、82路、99路、120路、126路、观光1线、专2路在“天安门东”站下车然后步行约900米到达午门。<br />
                    乘坐地铁1号线在“天安门东”站下车，步行约900米，即可从午门进入故宫。（故宫博物院的南门）<br />
                    故宫不设停车场，周边的公共停车场也较远，故不建议驾车前来。
                </dd>
            </dl>
            <dl>
                <dt>门票</dt>
                <dd>
                    <div th:text="${scenicspot.tickets}"> 门票:成人票60人民币/学生票20人民币；内部景点:珍宝馆10人民币/钟表馆10人民币 (4月1日-10月31日 周二-周日)<br />
                        门票:成人票40人民币/学生票20人民币；内部景点:珍宝馆10人民币/钟表馆10人民币 (11月1日-次年3月31日 周二-周日)<br />
                        半票:60岁及以上老年人、低保户，凭有效证件入园。<br />
                        免票:离休干部凭离休证、1.2米以下儿童、残疾人、随团导游，凭有效证件入园。<br />
                        提示：学生票包含，大中小学生，除去成人教育、研究生、故宫所有人需凭身份证入园。、故宫门票全部在官网提前十天预售，现场已不设购票窗口，但可微信支付入馆，每天入馆人数与网络售票共享。 、“三八”妇女节，女性观众享受门票半价优惠；“六一”儿童节，14周岁以下儿童（含14周岁），免费参观。随同家长一人，享受半价优惠；“八一”建军节，现役军人凭有效证件，免费参观。
                    </div>
                </dd>
            </dl>
            <dl>
                <dt>开放时间</dt>
                <dd th:text="${scenicspot.openingHours}">08:30-17:00；停止售票时间:16:00；停止入场时间:16:10 (4月1日-10月31日 周二-周日)<br />
                    08:30-16:30；停止售票时间:15:30；停止入场时间:15:40 (11月1日-次年3月31日 周二-周日)<br />
                    提示：除法定节假日外，全年实行周一全天闭馆。
                </dd>
            </dl>

            <div style="color:#999;font-size:12px;" data-cs-p="概况-感谢嗡嗡">
                *信息更新时间：<span th:text="${scenicspot.uptime}"></span>&nbsp;&nbsp;&nbsp;&nbsp;
            </div>
        </div>


        <!-- 位置 S -->
        <div class="mod mod-location">
            <div class="mhd" style="overflow: hidden;">景点位置<span style="font-size:80%;"></span><p class="sub" th:text="${scenicspot.address}">北京市东城区景山前街4号</p></div>
            <div style="width:950px;height:260px;" id="map"></div>
        </div>

        <!--百度地图DrivingRoute-->
        <script th:inline="javascript">
            // 初始化地图
            var map = new BMap.Map("map"); // 创建Map实例
            map.addControl(new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT})); // 左上角，添加比例尺
            map.addControl(new BMap.NavigationControl()); //左上角，添加默认缩放平移控件
            var target_point=new BMap.Point([[${scenicspot.longitude}]],[[${scenicspot.latitude}]]);
            map.centerAndZoom(target_point, 9);  // 初始化地图,设置中心点坐标和地图级别
            map.enableScrollWheelZoom(); //启动滚动轮缩放

            var geolocation = new BMap.Geolocation();  //实例化浏览器定位对象。

            //下面是getCurrentPosition方法。调用该对象的 getCurrentPosition()，与HTML5不同的是，这个方法原型是 getCurrentPosition(callback:function[, options: PositionOptions])，也就是说无论成功与否都执行回调函数1，第二个参数是关于位置的选项。 因此能否定位成功需要在回调函数1中自己判断。

            geolocation.getCurrentPosition(function(r){   //定位结果对象会传递给r变量
                if(this.getStatus() == BMAP_STATUS_SUCCESS){  //通过Geolocation类的getStatus()可以判断是否成功定位。
                    var mk = new BMap.Marker(r.point);    //基于定位的这个点的点位创建marker
                    //创建行车路线实例  map:检索区域(Map,Point,String)   renderOptions:结果呈现设置  {map:map}：展现结果的地图示例
                    var drivingRoute=new BMap.DrivingRoute(map,{renderOptions:{map:map}});
                    drivingRoute.search(r.point,target_point);
                    //设置检索后的回调函数 参数：results
                    drivingRoute.setSearchCompleteCallback(function(results){
                        var plan=results.getPlan(0); //获取第一个方案
                        var duration=plan.getDuration(true); //获取时间  duration:持续，期间
                        var distance=plan.getDistance(true); //获取距离  distance:距离
                        $(".mhd").children("span").text("（路程大约"+distance+",驾车时间大约"+duration+"）");
                    });
                    //设置标注点回调函数
                    drivingRoute.setMarkersSetCallback(function(pois){
                        pois[1].marker.setTitle([[${scenicspot.chineseName}]]);
                    })
                    // alert('您的位置：'+r.point.lng+','+r.point.lat);  //r对象的point属性也是一个对象，这个对象的lng属性表示经度，lat属性表示纬度。
                }
                else {
                    alert('failed'+this.getStatus());
                }
            },{enableHighAccuracy: true})

        </script>
    </div>

    <!-- 评论内容 -->
    <style type="text/css">
        .comment{
            font-size:140%;
            margin-top:50px;
            margin-bottom:30px;
            color:#FF9D00;
            border:none;
            font-weight:bold;
        }
        .one{
            width:950px;
            height:auto;
            margin-left:0px;
            padding-top:10px;
            border-bottom:1px dashed #CCCCCC;
        }
        .one .userPicture{
            width:50px;
            height:50px;
            border-radius:100px;
        }
        .one .userName{
            width:500px;
            height:20px;
            color:#FFAC26;
            position:relative;
            top:-50px;
            left:70px;
        }
        .one .content{
            width:850px;
            height:auto;
            position:relative;
            top:-40px;
            left:70px;
            color:#666666;
        }
        .one .content .one1{
            width: 850px;
            height:auto;
            font-size:90%;
            color:#FFAC26;
            overflow: auto;
            margin:0;
            margin-top: 20px;
            padding-bottom:10px;
            border-bottom:1px solid #CCCCCC;
        }
        .one .content .two {
            width:100%;
            height:auto;
            margin-top:5px;
            border-bottom:1px dashed #CCCCCC;
            font-size:80%;
            line-height:20px;
            padding:5px 0;
        }
        .one .content .two span{
            color:#FFAC26;
        }
        .reply{
            width:100%;
            height:100px;
            margin-top:10px;
            border:1px solid #FF9D00;
            color:black;
        }
        .replyBtn{
            width:50px;
            padding:5px 10px;
            background:#FF9D00;
            color:white;
            margin-left:94.2%;
        }
        .huifu1:hover,.huifu2:hover,.replyBtn:hover {
            cursor:pointer;
        }
    </style>
    <div data-anchor="commentlist" id="commentList" style="border:1px solid white;margin-bottom:50px;">
    </div>
    <input th:if="${session.user}!=null" type="hidden" th:value="${session.user.userId}" id="userId">
    <script th:inline="javascript">

        //时间转换
        function format_time(replyTime)
        {
            return replyTime.substring(0,replyTime.lastIndexOf(".")).replace("T"," ");
        }

        function loadComment(){
            $.ajax({
                url:'/scenicSpotCommentController/queryScenicsPotComment',
                type:'post',
                data:{
                    scenicSpotId:[[${scenicspot.scenicSpotId}]]
                },
                dataType:'JSON',
                success:function(data){
                    if(data!=""){
                        $("#commentList").empty();
                        //设置总评论数
                        $("#feng_feng_dian_ping").text("("+data[data.length-1].commentSum+"条)");
                        $("#commentList").append("<div class=\"comment\">嗡嗡点评（公有<span>"+data[data.length-1].commentSum+"</span>条真实评价）</div>");
                        //设置评论
                        for(var i=0;i<data.length-1;i++)
                        {
                            var comment=data[i].scenicSpotComment; //评论集合
                            var commentReply=data[i].reply; //评论回复对象

                            var start=comment.start;
                            var str="";
                            if(start=="1"){
                                str=" <span class=\"icon-bg comm-star comm-star1\"></span>";
                            }else if(start=="2"){
                                str=" <span class=\"icon-bg comm-star comm-star2\"></span>";
                            } else if(start=="3"){
                                str=" <span class=\"icon-bg comm-star comm-star3\"></span>";
                            } else if(start=="4"){
                                str=" <span class=\"icon-bg comm-star comm-star4\"></span>";
                            } else if(start=="5"){
                                str=" <span class=\"icon-bg comm-star comm-star5\"></span>";
                            }else if(start=="0"){
                                str=" <span class=\"icon-bg comm-star comm-star0\"></span>";
                            }

                            //拼接评论头像，用户名称，评论内容
                            var content="";
                            content+="<div class=\"one\">\n" +
                                "<img src='/"+comment.userPicture+"' class=\"userPicture\">\n" +
                                "<input type='hidden' value="+comment.scenicSpotCommentId+"><input type='hidden' value='"+comment.userId+"'><div class=\"userName\">"+comment.userName+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" +
                                ""+str+"</div>\n" +
                                "<div class=\"content\">"+comment.content+"<br/>";
                            var imgs=comment.pictures.split(",");
                            //拼接评论图片
                            if(imgs!=""){
                                for(var j=0;j<imgs.length;j++){
                                    content+="<img src='"+imgs[j]+"' style='width:200px;height:auto;padding:0;'>&nbsp;&nbsp;&nbsp;";
                                }
                            }
                            //拼接评论时间
                            //转换日期
                            content+="<div class=\"one1\"><span style=\"float:left;\">"+format_time(comment.commentTime)+"</span><br/>";
                            if($("#userId").val()!=comment.userId){
                                content+="<span style=\"float:right;\" class=\"huifu1\">回复</span></div>";
                            }
                            //拼接评论回复
                            if(commentReply!=""){
                                for(var j=0;j<commentReply.length;j++){
                                    content+="<div class=\"two\">\n" +
                                        "<input type='hidden' value="+comment.scenicSpotCommentId+"><input type='hidden' value='"+commentReply[j].userId+"'/> <span>"+commentReply[j].userName+"</span> <span style='color:black;'>回复</span>\n" +
                                        "<span>"+commentReply[j].replyUserName+"</span>：\n" +
                                        "<span style=\"color:black;\">"+commentReply[j].replyContent+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
                                        if($("#userId").val()!=commentReply[j].userId){
                                                content+="<span class=\"huifu2\">回复</span>";
                                        }
                                    content+="<br/><span style=\"color:black;\">"+format_time(commentReply[j].replyTime)+"</span></div>";
                                }
                            }
                            //拼接回复框
                            content+="<div style=\"display:none;\" class=\"three\">\n" +
                                "<textarea class=\"reply\"></textarea>\n" +
                                "<div class=\"replyBtn\">回复</div>\n" +
                                "</div>\n" +
                                "</div>\n" +
                                "</div>";
                            $("#commentList").append(content);
                        }

                    }
                    var replayUserName;
                    var replayUserId;
                    var scenicSpotCommentId;
                    //回复点击事件
                    $(".huifu1").click(function(){
                        $(this).parent().parent().children(".three").css("display","block"); //显示评论框
                        replayUserName=$(this).parent().parent().prev().text(); //回复用户名称
                        replayUserId=$(this).parent().parent().prev().prev().val(); //回复用户id
                        scenicSpotCommentId=$(this).parent().parent().prev().prev().prev().val(); //评论id
                        $(".reply").attr("placeholder","回复"+replayUserName);
                    });
                    //回复点击事件
                    $(".huifu2").click(function(){
                        $(this).parent().parent().children(".three").css("display","block"); //显示评论框
                        replayUserName=$(this).prev().prev().prev().prev().text(); //回复用户名称
                        replayUserId=$(this).prev().prev().prev().prev().prev().val(); //回复用户id
                        scenicSpotCommentId=$(this).prev().prev().prev().prev().prev().prev().val(); //评论id
                        $(".reply").attr("placeholder","回复"+replayUserName);
                    });
                    //回复提交事件
                    $(".replyBtn").click(function(){
                        if([[${session.user}]]!=null){
                            var content=$(this).prev().val();
                            $.ajax({
                                url:'/scenicSpotCommentReplyController/addScenicSpotCommentReply',
                                type:'post',
                                data:{
                                    content:content,
                                    replayUserName:replayUserName,
                                    replayUserId:replayUserId,
                                    scenicSpotCommentId:scenicSpotCommentId
                                },
                                dataType:'text',
                                success:function(data){
                                    if(data>0){
                                        $(".reply").val("");
                                        $(".three").css("display","none"); //显示评论框
                                        loadComment();
                                    }
                                }
                            })
                        }else{
                            alert("请登录");
                            window.location.href="#login"; //锚点
                        }
                    });
                    //文档双击事件关闭评论框
                    $(document).dblclick(function(){
                        $(".three").css("display","none");
                    });
                }
            });
        }

        loadComment();

    </script>
  <!-- 评论内容 -->

    <!-- 发表评论 -->
    <style>
        .huixian{
            width:20%;
            height:150px;
            border:1px solid #EFEFEF;
            text-align: center;
            position:absolute;
            top:0;
            left:30%;
            background:white;
            display:none;
        }
        .huixian:hover{
            cursor:pointer;
        }
    </style>
    <div data-anchor="comment">
        <div class="row row-reviewForm" id="comment_20181004083747" data-cs-p="点评" style="display: none;">
            <div class="wrapper">

                <div class="mfw-reviews">
                    <div id="_j_commentform_cnt">
                        <h2>
                            <strong th:text="${scenicspot.chineseName}">颐和园</strong>
                            <em>*</em>为必填选项
                        </h2>

                            <!--星星-->
                            <div class="review-item item-star">
                                <div class="label" style="color:black;"><em>*</em>总体评价</div>
                                <div class="review-star _j_rankblock" data-star="" name="rank">
                                    <input type="hidden" name="rank" id="rank" value="" essential="1" data-inputname="总体评价" />
                                    <span class="star _j_starcount"></span>
                                    <div class="click-star _j_starlist">
                                        <a role="button" title="千万别去" rel="nofollow"></a>
                                        <a role="button" title="不推荐" rel="nofollow"></a>
                                        <a role="button" title="一般般" rel="nofollow"></a>
                                        <a role="button" title="值得一去" rel="nofollow"></a>
                                        <a role="button" title="必须推荐" rel="nofollow"></a>
                                    </div>

                                </div>
                                <span class="txt-tips _j_startip">点击星星打分</span>
                            </div>
                            <!--星星-->

                            <!--评论内容-->
                            <div class="review-item item-comment">
                                <div class="label" style="color:black;"><em>*</em>评&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价</div>
                                <div class="content">
                                    <textarea class="_j_commentarea" id="content" name="comment" essential="1" data-inputname="点评内容" placeholder="详细、客观、真实，130字以上为佳！上传图片会加分哦！" data-minlen="15" data-maxlen="1000"></textarea>
                                    <p class="_j_commentcounttip">15-1000个字</p>
                                </div>
                            </div>
                            <!--评论内容-->

                            <!--图片上传-->
                            <div class="review-item item-photo" style="border:1px solid white;position: relative;top:-50px;">
                                <div class="label" style="color:black;">上传照片</div>
                                <form type="post" enctype="multipart/form-data" id="form1">
                                    <input type="file" name="img" id="selectFile" onchange="Filechange(this)" style="margin-top:5%;"/>
                                </form>
                                <div style="width:100%;height:auto;margin-top:20px;" id="pics">
                                </div>
                                <div class="huixian">
                                    <img src="/images/gugong1.jpg" id="huixian" width="100px" height="100px" />
                                    <div id="subImg" style="margin-left:25%;margin-top:3%;width:50%;height:auto;padding: 8px 0;text-align:center;border-radius:3px;background:#FFA800;color:white;">提交</div>
                                </div>
                                <input type="hidden" id="imgs"/>

                            </div>
                            <script>
                                function Filechange(obj){
                                    var selectFile=$("#selectFile").val();
                                    if(selectFile!=""){ //文件不能为空
                                        var fileType=selectFile.substring(selectFile.lastIndexOf("."));
                                        //文件类型必须为图片
                                        if(fileType==".jpg"||fileType==".png"||fileType==".gif"||fileType==".jpeg"||fileType==".JPG"||fileType==".PNG"||fileType==".GIF"||fileType==".JPEG"){
                                            //图片回显
                                            var file = obj.files;
                                            for(var i=0;i<file.length;i++){
                                                var freader = new FileReader();
                                                freader.readAsDataURL(file[i]); //将文件读取为DataUrl，存储在result中
                                                freader.onload = function (e) { //文件读取成功时触发
                                                    $("#huixian").attr("src", e.target.result);
                                                    $(".huixian").css("display","block");
                                                }
                                            }
                                        }else{
                                            $(obj).val("");
                                        }
                                    }
                                };

                                $("#subImg").click(function(){
                                    var formdata=new FormData($("#form1")[0]);
                                    $.ajax({
                                        url:'/scenicspotController/comment',
                                        type:'post',
                                        async:"false",
                                        data:formdata,
                                        processData: false, //不转换数据类型
                                        contentType: false,
                                        dataType:'text',
                                        success:function(data){
                                            $("#imgs").val($("#imgs").val()+","+data);
                                            $("#pics").append("<img src='"+data+"' width=\"100px\" height=\"100px\" />&nbsp;");
                                            $(".huixian").css("display","none");
                                        }
                                    })
                                });

                            </script>
                            <!--图片上传-->

                            <!--提交按钮-->
                            <div class="review-item item-action" style="position:relative;top:50px;left:0.5%;">
                                <a class="btn-large _j_submit" title="提交点评" id="subComment"  style="margin-top:-100px;margin-left:-20px;">提交点评</a>
                            </div>
                            <!--提交按钮-->

                    </div>
                </div>
                <script th:inline="javascript">

                    M.closure(function(require) {
                        var Comment = require('/js/common/Comment');
                        M.Event.once('comment prepared', function(args) {
                            var commentIns = new Comment({
                                container: '#_j_commentform_cnt'
                            });
                        });

                        // 是否直接初始化
                        M.Event.fire('comment prepared');
                    });

                    //提交点评点击事件
                    $("#subComment").click(function(){
                        var rank=$("#rank").val(); //星星数
                        var content=$("#content").val(); //评论内容
                        var imgs=$("#imgs").val();
                        imgs=imgs.substr(1);
                        if(rank>0&&content.length>14&&content.length<=1000){
                            $.ajax({
                                url:'/scenicSpotCommentController/scenicSpotAddComment',
                                type:'post',
                                data:{
                                    rank:rank,
                                    content:content,
                                    imgs:imgs,
                                    scenicSpotId:[[${scenicspot.scenicSpotId}]]
                                },
                                dataType:'text',
                                success:function(data){
                                    loadComment();
                                    $("#comment_20181004083747").css("display","none");
                                }
                            });
                        }
                    });

                </script>
            </div>
        </div>

    </div>

</div>




<!--页脚-->
<link href="http://css.mafengwo.net/css/mfw-footer.css?1533714581" rel="stylesheet" type="text/css"/>
<div id="footer">
    <div class="ft-content" style="width: 1105px">
        <div class="ft-info clearfix">
            <dl class="ft-info-col ft-info-intro">
                <dt>全球旅游消费指南 </dt>
                <dd>覆盖全球200多个国家和地区</dd>
                <dd><strong>100,000,000</strong> 位旅行者</dd>
                <dd><strong>920,000</strong> 家国际酒店</dd>
                <dd><strong>21,000,000</strong> 条真实点评</dd>
                <dd><strong>382,000,000</strong> 次攻略下载</dd>
                <dd><a class="highlight" href="http://www.mafengwo.cn/activity/sales_report2017/index" target="_blank">中国旅游行业第一部“玩法”</a></dd>
            </dl>
            <dl class="ft-info-col ft-info-about">
                <dt>关于我们</dt>
                <dd><a href="http://www.mafengwo.cn/s/about.html" rel="nofollow">关于嗡嗡嗡</a><a href="http://www.mafengwo.cn/s/contact.html" class="m_l_10" rel="nofollow">联系我们</a></dd>
                <dd><a href="http://www.mafengwo.cn/s/private.html" rel="nofollow">隐私政策</a><a href="http://www.mafengwo.cn/s/logo.html" rel="nofollow" class="m_l_10">商标声明</a></dd>
                <dd><a href="http://www.mafengwo.cn/s/agreement.html" rel="nofollow">服务协议</a><a href="http://www.mafengwo.cn/s/rules.html" rel="nofollow" class="m_l_10">游记协议</a></dd>
                <dd><a href="http://www.mafengwo.cn/s/salesagreement.html" rel="nofollow">商城平台服务协议</a></dd>
                <dd><a href="http://www.mafengwo.cn/s/property.html" rel="nofollow">网络信息侵权通知指引</a></dd>
                <dd><a href="http://www.mafengwo.cn/s/sitemap.html" target="_blank">网站地图</a><a class="joinus highlight m_l_10" title="嗡嗡嗡团队招聘" target="_blank" href="http://www.mafengwo.cn/s/hr.html" rel="nofollow">加入嗡嗡嗡</a></dd>
            </dl>
            <dl class="ft-info-col ft-info-service">
                <dt>旅行服务</dt>
                <dd>
                    <ul class="clearfix">
                        <li><a target="_blank" href="http://www.mafengwo.cn/gonglve/">旅游攻略</a></li>
                        <li><a target="_blank" href="http://www.mafengwo.cn/hotel/">酒店预订</a></li>
                        <li><a target="_blank" href="http://www.mafengwo.cn/sales/">旅游特价</a></li>
                        <li><a target="_blank" href="http://zuche.mafengwo.cn/">国际租车</a></li>
                        <li><a target="_blank" href="http://www.mafengwo.cn/wenda/">旅游问答</a></li>
                        <li><a target="_blank" href="http://www.mafengwo.cn/insure/">旅游保险</a></li>
                        <li><a target="_blank" href="http://z.mafengwo.cn">旅游指南</a></li>
                        <li><a target="_blank" href="http://huoche.mafengwo.cn">订火车票</a></li>
                        <li><a target="_blank" href="http://www.mafengwo.cn/travel-news/">旅游资讯</a></li>
                        <li><a target="_blank" href="http://www.mafengwo.cn/app/intro/gonglve.php">APP下载</a></li>
                        <li style="width: 120px;"><a target="_blank" href="http://www.mafengwo.cn/sales/alliance.php" class="highlight">旅行商城全球商家入驻</a></li>
                    </ul>
                </dd>
            </dl>
            <dl class="ft-info-col ft-info-qrcode">
                <dd>
                    <span class="ft-qrcode-tejia"></span>
                    <p>嗡嗡嗡良品<br>官方服务号</p>
                </dd>
                <dd>
                    <span class="ft-qrcode-weixin"></span>
                    <p>嗡嗡嗡旅游<br>订阅号</p>
                </dd>
                <dd>
                    <span class="ft-qrcode-weixin" style="background-image: url('https://p3-q.mafengwo.net/s10/M00/48/A9/wKgBZ1t_4sSAVJ6uAAAlzJ0PZgU881.png?imageMogr2%2Fthumbnail%2F%2194x90r%2Fgravity%2FCenter%2Fcrop%2F%2194x90%2Fquality%2F90')"></span>
                    <p>嗡嗡嗡APP<br>扫描立即下载</p>
                </dd>
            </dl>
            <dl class="ft-info-social">
                <dt>向崇尚自由的加勒比海盗致敬！</dt>
                <dd>
                    <a class="ft-social-weibo" target="_blank" href="http://weibo.com/mafengwovip" rel="nofollow"><i class="ft-social-icon"></i></a>
                    <a class="ft-social-qqt" target="_blank" href="http://t.qq.com/mafengwovip" rel="nofollow" ><i class="ft-social-icon"></i></a>
                    <a class="ft-social-qzone" target="_blank" href="http://1213600479.qzone.qq.com/" rel="nofollow"><i class="ft-social-icon"></i></a>
                </dd>
            </dl>
        </div>
    </div>
</div>

<!--返回顶部-->
<link href="http://css.mafengwo.net/css/mfw-toolbar.css?1493174418" rel="stylesheet" type="text/css"/>
<div class="mfw-toolbar" id="_j_mfwtoolbar">
    <div class="toolbar-item-top">
        <a role="button" class="btn _j_gotop">
            <i class="icon_top"></i>
        </a>
    </div>
</div>
<script language="javascript" type="text/javascript">
    if (typeof M !== "undefined" && typeof M.loadResource === "function") {
        M.loadResource("http://js.mafengwo.net/js/cv/js+Dropdown:js+pageletcommon+pageHeadUserInfoWWWNormal:js+jquery.tmpl:js+M+module+InputListener:js+M+module+SuggestionXHR:js+M+module+DropList:js+M+module+Suggestion:js+M+module+MesSearchEvent:js+SiteSearch:js+AHeader:js+jquery.lazyload:js+M+module+dialog+Layer:js+M+module+dialog+DialogBase:js+M+module+dialog+Dialog:js+M+module+dialog+alert:js+poi+ADetail_v2:js+hotel+mfwmap+mfwmap-util:js+hotel+mfwmap+mfwmap-event:js+hotel+mfwmap+mfwmap-runtime-google:js+hotel+mfwmap+mfwmap-runtime-amap:js+hotel+mfwmap+mfwmap-runtime-leaflet:js+hotel+mfwmap+mfwmap:js+hotel+mfwmap+mfwmap-overlays:js+hotel+mfwmap+mfwmap-widgets:js+poi+ControllerPoiLocation:js+jquery.mfwUseful:js+jquery.mfwCommentReply:js+poi+ControllerPoiComment:js+poi+ControllerPoiSales:js+hotel+mfwmap+mfwmap-overlays-v2:js+poi+ControllerPoiAround:js+M+module+StarRating:js+M+module+KeyListener:js+M+module+Toggle:js+M+module+Select:js+M+module+dialog+confirm:js+plupload:js+module+uploader+Pluploader:js+common+CommentPicDialog:js+common+CommentPicUploader:js+common+Comment:js+M+module+TopTip:js+M+module+PageAdmin:js+M+module+Storage:js+M+module+Cookie:js+M+module+ResourceKeeper:js+jquery.jgrowl.min:js+AMessage:js+M+module+FrequencyVerifyControl:js+M+module+FrequencySystemVerify:js+ALogin:js+M+module+ScrollObserver:js+M+module+QRCode:js+AToolbar:js+ACnzzGaLog:js+ARecruit:js+ALazyLoad^YlZWQw^1538219551.js");
    }
</script>

</body>
</html>
